# WordPress 2026 Theme + WooCommerce Integration Plan

## 1) Confirmed product and checkout model

- **One WooCommerce variable product per book**.
- **Each format is a variation** (e.g., EPUB, PDF, DOCX, MOBI).
- **Single-format purchase only** (no “all-formats” bundle in MVP).
- **No subscriptions or memberships**.
- **Downloads use standard WooCommerce downloadable products**.
- **No DRM/watermarking**.

## 2) Existing system behavior to preserve

- Site information architecture remains **Series → Books** with customer browsing by **Genre** on landing pages.
- Existing book-card/block pattern is retained and modernized.
- Existing URL structures/permalinks are preserved.
- Customer-facing content remains what the legacy theme exposes today, plus:
  - **Preview button** (shows the book’s *Excerpt*).
  - **Buy button** and visible list of available formats.
- Catalog scale target:
  - Current: ~912 books across 10–12 languages.
  - Growth target: ~1500 books.

## 3) New commerce behavior

- Payment gateway: **Stripe**.
- Tax behavior: US store with **no tax collected** (configured via WooCommerce tax settings).
- **Multi-currency enabled**.
- Sales features enabled:
  - Coupons
  - Upsells
  - Preorders
  - Free books
- No role-based pricing.
- No formal refund policy page in scope for MVP.

## 4) Data ownership and synchronization

### Source of truth

- **Book-generation app** remains source of truth for core book metadata and format availability.
- **WordPress/WooCommerce** manages customer-facing products and transactions.

### Sync requirements

When a book is created/updated in the app, integration must automatically create/update in WordPress:

- Book post/content object fields (title, description, cover, language, series references, etc.).
- Corresponding WooCommerce variable product.
- Format variations and variation pricing (same price for all formats unless manually overridden later).
- Downloadable file links for each format variation.
- Product visibility/status flags (including free/preorder logic).

### Integration implementation approach

Use a **push API from app → WordPress plugin endpoint**:

1. App emits webhook or scheduled push with book payload.
2. Custom WP plugin endpoint authenticates request (HMAC/API key).
3. Plugin upserts:
   - Book CPT or mapped post type used by the theme.
   - WooCommerce product + variations.
4. Plugin logs sync status and errors for retry.

This avoids direct cross-database writes and supports zero-downtime rollout.

## 5) Proposed technical architecture

## 5.1 WordPress theme (2026-ready)

Build a modern block-first theme (or hybrid) with:

- Reusable book listing blocks:
  - Series grid
  - Book card
  - Book detail panel
- Book card fields:
  - Cover image
  - Title/series metadata
  - Description
  - Format badges
  - Preview button
  - Buy button (direct to selected variation/purchase flow)
- Accessibility and responsive targets:
  - WCAG 2.2 AA-level patterns
  - Mobile-first layout

## 5.2 WordPress plugin (integration + commerce glue)

Create a companion plugin for:

- Inbound sync endpoint (secure auth + validation).
- Mapping app payload to WP + Woo data model.
- Variation management per format.
- Download file URL updates.
- Optional scheduled reconciliation job (nightly consistency check).
- Structured logging + admin status screen.

## 5.3 WooCommerce extensions

- Stripe gateway plugin.
- Multi-currency plugin compatible with Stripe + variable downloadable products.
- Preorder plugin (if needed for preorder workflow beyond core scheduling).

## 6) Data model mapping (initial)

For each book:

- `book_external_id` (app ID) stored as immutable meta key.
- `series_external_id` and language code as taxonomy/meta.
- Product type: `variable`.
- Variation attribute: `format`.
- Variations created only for formats currently generated by app.
- Price: same base price for each variation (configurable default).
- Downloadables attached per variation.

For preview:

- Keep full story content excluded from public view.
- Expose excerpt-only content via:
  - modal preview, or
  - book detail section with controlled excerpt length.

## 7) URL and migration strategy (zero downtime)

1. Build on staging with production copy.
2. Maintain permalink structure and key route slugs.
3. Parallel-run sync plugin in “observe mode” (log only) before write mode.
4. Run migration/reconciliation scripts to verify all books/products/variations exist.
5. UAT on staging (catalog browse, preview, cart, checkout, download).
6. Production cutover during low-traffic window.
7. Keep rollback path:
   - Theme switch-back ready.
   - Sync plugin write mode togglable.

## 8) Security and compliance baseline

- WordPress hardening:
  - least-privileged admin roles
  - MFA for admin users
  - XML-RPC restrictions if unused
  - rate limiting/WAF
- Plugin endpoint security:
  - HMAC signatures
  - timestamp + replay protection
  - IP allowlisting (optional)
- Operational controls:
  - daily backups (DB + media + downloadable assets)
  - vulnerability scanning and dependency update cadence
  - audit logs for sync + Woo order events
- PCI scope minimized by using Stripe hosted tokenized flow.

## 9) Performance and scale considerations

- 1500-book target supports:
  - indexed metadata queries
  - object caching
  - page caching/CDN for public pages
- Optimize cover image sizes and lazy loading.
- Precompute series pages where possible.
- Reconciliation job chunking to avoid long-running admin requests.

## 10) Implementation phases

## Phase 0 — Discovery and extraction

- Unpack legacy app/theme.
- Document current DB schema and file storage paths (including GoDaddy path conventions).
- Inventory all currently exposed customer-facing fields.

## Phase 1 — Contract-first integration

- Define JSON payload contract from app to WP.
- Build WP plugin endpoint + auth + logging.
- Implement idempotent upsert for books + Woo products + variations.

## Phase 2 — New theme foundation

- Build modern theme shell and global style system.
- Implement series/book listing templates.
- Implement book card with preview + buy CTA.

## Phase 3 — Commerce features

- Configure Stripe.
- Configure multi-currency.
- Enable coupons, upsells, preorder, and free-book flows.
- Validate download delivery on completed payment.

## Phase 4 — Migration and QA

- Full catalog sync from app.
- Automated checks for missing products/variations/downloadables.
- End-to-end UAT scenarios across currencies and languages.

## Phase 5 — Production cutover

- Switch theme + enable plugin write mode.
- Monitor sync/order/download logs.
- Post-launch fixes and optimization.

## 11) Acceptance criteria for MVP

- Every active book in app has corresponding WP display object and Woo variable product.
- Variations exist only for available formats and can be purchased singly.
- Preview button shows excerpt without exposing full story content.
- Buy flow completes successfully through Stripe.
- Download access works through WooCommerce standard flow.
- Existing public URLs/permalinks continue to resolve.
- Series → books browsing remains intact with modernized UI.

## 12) Immediate next actions

1. Extract both ZIPs and baseline current schema/templates.
2. Produce integration payload spec (`book`, `series`, `formats`, `files`, `status`).
3. Scaffold WP integration plugin (`mpa-book-sync`).
4. Scaffold new theme (`mpa-books-2026`) with series and book card templates.
5. Implement one end-to-end pilot for 5 books before full catalog sync.


## 13) Localization requirements (added)

- The storefront must support a side-menu language selector similar to the legacy theme.
- If a visitor enters only the base URL, detect browser preferred language and route to that language storefront when available.
- If a visitor enters a specific deep URL, do not redirect away from that URL.
- Language links must filter catalog pages so visitors only browse books in the selected language.
- Theme UI strings (buttons, labels, empty states, navigation labels) must be translatable via WordPress text domain files.
- Locale handling should support non-English and RTL languages where available.
- Book metadata synced from the app should include `language`, optional `locale`, and optional `text_direction`.

